<!DOCTYPE html>
<html lang="en">

<script src="../public/sidenav.js"></script>
<title>Buscar Beneficiario</title>

<%- include home.ejs %>
<body>
    <main>
        <div class="row col s12">
            <div class="col s6">
            <form method="POST" id="form_bnf">
                <h3>Buscar Beneficiario</h3>
                <blockquote style="background-color: bisque;">
                    <%= typeof loginMessage != 'undefined' ? loginMessage : '' %>
                    <%= typeof message != 'undefined' ? message : '' %>
                </blockquote>
                <div class="col s9">
                    <input type="text" class="validate" value="<%= typeof res.edad != 'undefined' ? res.edad : '' %>" id="edad_bnf" hidden>
                    <input type="text" class="validate" value="<%= typeof res.last_card != 'undefined' ? res.last_card : '' %>" id="last_card_bnf" hidden>
                    <!-- <div class="input-field col s9">
                        <input id="search" name="edtBuscar" type="text" class="validate"
                            value="<%= typeof id != 'undefined' ? id : '' %><%= typeof aux != 'undefined' ? aux : '' %>">
                        <label for="search">Nº Matrícula</label>
                    </div> -->
                    <div class="input-field col s9">
                        <i class="material-icons prefix">search</i>
                        <input type="text" id="nombre" class="autocompleteB" name="edtBuscarNombre"
                            value="<%= typeof id != 'undefined' ? id : '' %><%= typeof aux != 'undefined' ? aux : '' %>">
                        <label for="nombre">Nombre Completo</label>
                    </div>
                    <div class="input-field col s3">
                        <button class="btn waves-effect waves-light" type="submit" name="btnBuscar" id="btnBuscar">
                                <% if (loginMessage != '' || message != '') { %>Actualizar <%} else {%>
                                Buscar <%}%>
                            <i class="material-icons right">search</i>
                        </button>
                    </div>
                    <div class="input-field col s12">
                        <input id="matricula" name="matricula" type="text" class="validate"
                            value="<%= typeof res.cod_bnf != 'undefined' ? res.cod_bnf : '' %>" disabled>
                        <label for="matricula">Nº Matricula</label>
                    </div>
                    <!-- <div class="input-field col s12">
                        <input id="last_name" name="apellidos" type="text" class="validate"
                            value="<%= typeof apellido != 'undefined' ? apellido : '' %>" disabled>
                        <label for="last_name">Apellidos</label>
                    </div> -->
                    <div class="input-field col s12">
                        <input id="company" name="empresa" type="text" class="validate"
                            value="<%= typeof new_emp.nom_emp != 'undefined' ? new_emp.nom_emp : '' %>" disabled>
                        <label for="company">Empresa</label>
                    </div>
                    <!-- <div class="input-field col s12">
                        <input id="num_matricula" name="nro_matricua" type="text" class="validate"
                            value="<%= typeof codigo != 'undefined' ? codigo : '' %>" disabled>
                        <label for="num_matricula">Nro. Matricula</label>
                    </div> -->
                    <div class="input-field col s12">
                        <input id="birth_date" name="birth_date" type="text" class="validate"
                            value="<%= typeof res.fec_nac != 'undefined' ? res.fec_nac : '' %>" disabled>
                        <label for="birth_date">Fecha de Nacimiento</label>
                    </div>
                    <div class="input-field col s12">
                        <input id="edad" name="edad" type="text" class="validate"
                            value="<%= typeof res.edad != 'undefined' ? res.edad : '' %>" disabled>
                        <label for="edad">Edad</label>
                    </div>
                    <div class="input-field col s12" hidden>
                        <input id="tipo_bnf" name="tipo_bnf" type="text" class="validate"
                            value="<%= typeof res.tipo_bnf != 'undefined' ? res.tipo_bnf : '' %>" disabled>
                        <label for="tipo_bnf">Tipo_bnf</label>
                    </div>
                    <div class="input-field col s12">
                        <input id="parentezco" name="parentezco" type="text" class="validate"
                            value="<%= typeof res.nom_parent != 'undefined' ? res.nom_parent : '' %>" disabled>
                        <label for="parentezco">Parentezco</label>
                    </div>
                </div>
                <div class="col s3">
                    <div class="file-field input-field">
                            <img style="width: 100%;" src="<%= typeof file_bnf != 'undefined' ? file_bnf : '' %>">
                            <% if (nombre !== '') { %>
                            <div class="file-field input-field">
                                <div class="btn">
                                    <input type="file" name="photo_bnf" id="photo_bnf">
                                    <i class="material-icons">file_upload</i>
                                </div>
                                <div class="file-path-wrapper">
                                    <input class="file-path validate" type="text" placeholder="Seleccionar Foto">
                                </div>
                            </div>
                            <button class="btn waves-effect waves-light" type="submit" name="btnAgregarFoto"
                                id="btnAgregarFoto"> <% if (file_bnf !== '') { %>Actualizar Foto <%} else {%> Agregar Foto <%}%>
                                <i class="material-icons right">add_a_photo</i>
                            </button>
                            <%}%>
                    </div>
                </div>
                
                <div class="input-field col s12">
                    <h5>Registrar Datos</h5>
                    <blockquote id="msgRD" style="background-color: bisque;">
                        <%= typeof msgRD != 'undefined' ? msgRD : '' %>
                    </blockquote>
                </div>
                <div class="input-field col s3">
                    <input id="join_date" name="fec_ing" type="text" class="datepicker"
                        value="<%= typeof res.fec_ing != 'undefined' ? res.fec_ing : '' %>"
                        <% if(res.fec_ing !== null){ %>disabled <% } else {%><%= res.fec_ing %><%}%>>
                        <label for="join_date">Fecha de Ingreso</label>
                </div>
                <div class="input-field col s3">
                    <input id="ci" name="ci" type="text" class="validate"
                        value="<%= typeof res.ci != 'undefined' ? res.ci : '' %>" <% if(res.ci !== null){ %>readonly <% } else {%><%= res.ci %><%}%>>
                        <label for="ci">CI.</label>
                </div> 
                <div class="input-field col s3">
                    <select name="ci_loc" id="ci_loc">
                    <option value="" selected><% if(res.ci_loc !== null){%><%= res.ci_loc %>
                        <% } else {%>Elige un Lugar<%}%></option>
                        <option value="CH" <% if(res.ci_loc !== null){ %> disabled<% }%>>Chuquisaca</option>
                        <option value="LP" <% if(res.ci_loc !== null){ %> disabled<% }%>>La Paz</option>
                        <option value="CB" <% if(res.ci_loc !== null){ %> disabled<% }%>>Cochabamba</option>
                        <option value="OR" <% if(res.ci_loc !== null){ %> disabled<% }%>>Oruro</option>
                        <option value="PT" <% if(res.ci_loc !== null){ %> disabled<% }%>>Potosí</option>
                        <option value="TJ" <% if(res.ci_loc !== null){ %> disabled<% }%>>Tarija</option>
                        <option value="SC" <% if(res.ci_loc !== null){ %> disabled<% }%>>Santa Cruz</option>
                        <option value="BE" <% if(res.ci_loc !== null){ %> disabled<% }%>>Beni</option>
                        <option value="PD" <% if(res.ci_loc !== null){ %> disabled<% }%>>Pando</option>
                    </select>
                    <label>Lugar</label>
                </div>
                <div class="input-field col s3">
                    <select name="select_sangre" id="select_sangre">
                        <option value="<%= res.tipo_sangre %>" selected><% if(res.tipo_sangre !== ''){ %><%= res.tipo_sangre %>
                            <% } else {%>Elige un Tipo<%}%></option>
                        <option value="A Rh+" <% if(res.tipo_sangre !== ''){ %> disabled<% }%>>A Rh+</option>
                        <option value="A Rh-" <% if(res.tipo_sangre !== ''){ %> disabled<% }%>>A Rh-</option>
                        <option value="B Rh+" <% if(res.tipo_sangre !== ''){ %> disabled<% }%>>B Rh+</option>
                        <option value="B Rh-" <% if(res.tipo_sangre !== ''){ %> disabled<% }%>>B Rh-</option>
                        <option value="AB Rh+" <% if(res.tipo_sangre !== ''){ %> disabled<% }%>>AB Rh+</option>
                        <option value="AB Rh-" <% if(res.tipo_sangre !== ''){ %> disabled<% }%>>AB Rh-</option>
                        <option value="O Rh+" <% if(res.tipo_sangre !== ''){ %> disabled<% }%>>O Rh+</option>
                        <option value="O Rh-" <% if(res.tipo_sangre !== ''){ %> disabled<% }%>>O Rh-</option>
                    </select>
                    <label>Tipo de Sangre</label>
                </div>
                <div class="input-field col s3">
                    <% if (res.tipo_sangre === null || res.tipo_sangre == '' || res.fec_ing === null || res.fec_ing =='') { %>
                    <button class="btn waves-effect waves-light" type="submit" name="btnRegistrar" value="clic"
                        id="btnRegistrar">Registrar
                        <i class="material-icons right">person_add</i>
                    </button>
                    <%}%>
                        
                </div>
                </form>
                </div>
                    <div class="col s6" style="margin-bottom: 10px;">
                        <h3>Historial de Carnet</h3>
                        <% if (nombre !== '' && res.tipo_sangre !== null) { %>
                    <button class="btn waves-effect waves-light" type="button"
                        id="btn_add_card_B">Agregar Carnet
                        <i class="material-icons right">add_box</i>
                    </button>
                    <%}%>
                    <% if (nombre !== '' && res.tipo_sangre !== null && historial.length > 0) { %>
                    <button class="btn waves-effect waves-light" type="button" 
                        id="btn_recov_card_B">Recuperar Carnet
                        <i class="material-icons right">autorenew</i>
                    </button>
                    <%}%>
                </div>
                    <div class="col s6" id="historialB" style="height: 750px; overflow-y: scroll;">
                        <% for(var i=0; i<historial.length; i++) {%>
                    <div class="card blue-grey">
                        <div class="card-content white-text">
                            <h5><b>Carnet: </b> <%= historial[i].id_carnet %> (<%= historial[i].estado %>)
                               || Frente: <%= historial[i].front %> Atras: <%= historial[i].back %>
                            </h5>
                            <form action="/verificarCarnetB" method="POST">
                                <ul>
                                    <input type="text" name="id_imp" value="<%= historial[i].id_imp %>" hidden>
                                    <li><b>Usuario: </b> <input type="text" name="usuario"
                                            value="<%= historial[i].login %>" hidden><%= historial[i].login %>
                                    </li>
                                    <li><b>Edad: </b> <%= historial[i].edad %> Años</li>
                                    <li><b>Fecha Emision: </b> <%= historial[i].fec_emision %></li>
                                    <li><b>Valido hasta: </b> <%= historial[i].fec_fin %></li>
                                    <li style="background-color: #ee6e73;"><b>Comprobante:</b>
                                        <%= historial[i].comprobante %>
                                        <input type="text" name="nro_comprobante"
                                            value="<%= historial[i].comprobante %>" hidden>
                                    </li>
                                    <input type="text" name="codigo" value="<%= historial[i].cod_bnf %>" hidden>
                                    <!-- <input type="text" name="parentezco" value="<%= res.nom_parent %>" hidden> -->
                                    <!-- <input type="text" id="tipo_bnf" value="<%= res.tipo_bnf %>" hidden> -->
                                    <li style="background-color: #009688;"><b>Motivo: </b>
                                        <%= historial[i].motivo %></li>
                                    <li><b>Tipo Validez: </b> <%= historial[i].validez %></li>
                                    <% if (historial[i].estado === '0') { %>
                                    <button class="btn waves-effect waves-light" type="submit" name="btnImprimir"
                                        id="btnImprimir">Imprimir
                                        <i class="material-icons right">print</i>
                                    </button>
                                    <% } %>
                                    <% if (historial[i].estado === '1' && historial[i].fec_emision === historial[i].fec_servidor) { %>
                                    <button class="btn waves-effect waves-light" type="submit" name="btnRImprimir"
                                        id="btnRImprimir">ReImprimir
                                        <i class="material-icons right">print</i>
                                    </button>
                                    <% } %>
                                </ul>
                            </form>
                        </div>
                    </div>
                    <% } %>
                </div>
        </div>
    </main>
    <script src="../public/js/Beneficiarios/formBnf.js"></script>
</body>
</html>